dnl Process this file with autoconf to produce a configure script.
AC_INIT([eina], 0.6.0, xuzo@cuarentaydos.com)
AM_INIT_AUTOMAKE([eina], [0.6.0])
AM_CONFIG_HEADER(config.h)
AM_MAINTAINER_MODE

dnl aclocal flags
ACLOCAL="$ACLOCAL $ACLOCAL_FLAGS"

AC_PROG_CC
AC_ISC_POSIX
dnl AM_PROG_CC_STDC <- Is useless?
AC_HEADER_STDC
AC_PROG_INTLTOOL
AM_PROG_LIBTOOL

dnl
dnl Debug support
dnl
AC_ARG_ENABLE(debug, [  --disable-debug         compile with debug enable)],disable_debug=yes, disable_debug=no)
if test "x$disable_debug" = "xno"; then
	DEBUG_CFLAGS="$PACKAGE_CFLAGS -g -pg"
fi

AC_PATH_PROG(PKG_CONFIG, pkg-config)
GLIB_GENMARSHAL=`$PKG_CONFIG --variable=glib_genmarshal glib-2.0`
AC_SUBST(GLIB_GENMARSHAL)

#*******************************************************************************
# Internationalization
#*******************************************************************************
GETTEXT_PACKAGE=eina
AC_SUBST(GETTEXT_PACKAGE)
AC_DEFINE_UNQUOTED(GETTEXT_PACKAGE,"$GETTEXT_PACKAGE", [GETTEXT package name])
AM_GLIB_GNU_GETTEXT

dnl In the future consider to:
dnl  Add dbus interface
dnl  Include some gnome deps (gconf)
pkg_modules="glib-2.0 >= 2.14, \
	gmodule-2.0 >= 2.14, \
	gio-2.0 >= 2.16, \
	gtk+-2.0 >= 2.12, \
	liblomo-1.0 >= 0.94.0"
dnl	WebKitGtk = 1d, \
PKG_CHECK_MODULES(PACKAGE, $pkg_modules)

dnl gmodule is used by shared object aka plugins
gmodule_modules="gmodule-2.0 >= 2.14"
PKG_CHECK_MODULES(GMODULE, $gmodule_modules)
AC_SUBST(GMODULE_CFLAGS)
AC_SUBST(GMODULE_LIBS)

dnl
dnl Check for curl, cover is a core-component
dnl
AC_PATH_PROG(CURL_CONFIG, curl-config)
if test -z "$CURL_CONFIG"; then
	HAVE_CURL="no"
	echo "Error: libcurl headers not found"
	exit 1
else
	CURL_CXXFLAGS="`$CURL_CONFIG --cflags`"
	CURL_LIBS="`$CURL_CONFIG --libs`"
	HAVE_CURL="yes"
fi


dnl
dnl Plugins
dnl

dnl
dnl sqlite3 flags for adb plugin
dnl
sqlite3_modules="sqlite3 >= 3.2"
PKG_CHECK_MODULES(SQLITE3, $sqlite3_modules,
	[
		AC_SUBST(SQLITE3_CFLAGS)
		AC_SUBST(SQLITE3_LIBS)
		HAVE_SQLITE3=yes
	],
	[
		HAVE_SQLITE3=no
	]
	)
AM_CONDITIONAL(USE_ADB, test x"$HAVE_SQLITE3" = "xyes")

dnl
dnl libnotify plugin
dnl
libnotify_modules="libnotify >= 0.4.0"
PKG_CHECK_MODULES(LIBNOTIFY, $libnotify_modules,
     [
        AC_SUBST(LIBNOTIFY_CFLAGS)
        AC_SUBST(LIBNOTIFY_LIBS)
        AC_DEFINE(USE_NOTIFY, [1], Build notify plugin)
        HAVE_NOTIFY=yes
    ],
    [
        HAVE_NOTIFY=no
    ]
    )
AM_CONDITIONAL(USE_NOTIFY, test x"$HAVE_NOTIFY" = "xyes")

dnl
dnl LastfmInfo plugin
dnl
webkitgtk_modules="WebKitGtk = 1d"
PKG_CHECK_MODULES(WEBKITGTK, $webkitgtk_modules,
     [
        AC_SUBST(WEBKITGTK_CFLAGS)
        AC_SUBST(WEBKITGTK_LIBS)
        HAVE_WEBKITGTK=yes
    ],
    [
        HAVE_WEBKITGTK=no
    ]
    )
AM_CONDITIONAL(USE_LASTFMINFO, test x"$HAVE_WEBKITGTK" = "xyes")

PACKAGE_CFLAGS="$PACKAGE_CFLAGS $CURL_CXXFLAGS -DEINA_COMPILATION -DG_DISABLE_DEPRECATED -DGTK_DISABLE_DEPRECATED -DGEL_DISABLE_DEPRECATED -DGEL_UI_DISABLE_DEPRECATED"
PACKAGE_CFLAGS="$PACKAGE_CFLAGS -Werror -Wall"
PACKAGE_LIBS="$PACKAGE_LIBS $CURL_LIBS"
AC_SUBST(PACKAGE_CFLAGS)
AC_SUBST(PACKAGE_LIBS)

dnl
dnl Check for working sink
dnl
dnl AM_GST_ELEMENT_CHECK(osssink, HAVE_OSSSINK=yes,  HAVE_OSSSINK=no)
dnl if ...
dnl 	AC_MSG_ERROR([message])
dnl fi

dnl
dnl Check for codecs support
dnl
dnl AM_GST_ELEMENT_CHECK(playbin,   HAVE_PLAYBIN=yes, HAVE_PLAYBIN=no)
dnl AM_GST_ELEMENT_CHECK(mad,       HAVE_MP3=yes,     HAVE_MP3=no)
dnl AM_GST_ELEMENT_CHECK(vorbisdec, HAVE_OGG=yes,     HAVE_OGG=no)
dnl AM_GST_ELEMENT_CHECK(wavparse,  HAVE_WAV=yes,     HAVE_WAV=no)
dnl AM_GST_ELEMENT_CHECK(flacdec,   HAVE_FLAC=yes,    HAVE_FLAC=no)

dnl
dnl GConf Stuff
dnl AC_PATH_PROG(GCONFTOOL, gconftool-2)
dnl AM_GCONF_SOURCE_2
dnl

dnl
dnl i18n Stuff
dnl 
GETTEXT_PACKAGE=eina
AC_SUBST(GETTEXT_PACKAGE)
AC_DEFINE_UNQUOTED(GETTEXT_PACKAGE,"$GETTEXT_PACKAGE", [Gettext package.])
ALL_LINGUAS="es ca"
AM_GLIB_GNU_GETTEXT

dnl Keep in alphabetical order
AC_OUTPUT([
Makefile
debian/Makefile
gel/Makefile
misc/Makefile
misc/eina.desktop
pixmaps/Makefile
plugins/Makefile
plugins/hooktest/Makefile
plugins/adb/Makefile
plugins/lastfminfo/Makefile
plugins/notify/Makefile
plugins/recently/Makefile
po/Makefile.in
src/Makefile
ui/Makefile
])

